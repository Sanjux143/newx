name: Android CI

on:
  push:
  pull_request:
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v4

    - name: Set up JDK 17
      uses: actions/setup-java@v4
      with:
        java-version: '17'
        distribution: 'temurin'
        cache: gradle

    - name: Install gdown
      run: |
       pip install gdown

       - name: Download Google Drive assets
        run: |
        mkdir -p app/src/main/assets/
        gdown --fuzzy "https://drive.google.com/file/d/1MgfQ-cWET5JU59HYh5y_e6dyfA6gLgBP/view?usp=drive_link" -o app/src/main/assets/imagefs.txz
        gdown --fuzzy "https://drive.google.com/file/d/1ImPvxtXiUJz4W82XjB7-G9WtUVueSE5Q/view?usp=drive_link" -o app/src/main/assets/proton-9.0-arm64ec.txz
        gdown --fuzzy "https://drive.google.com/file/d/114eG0RTgnc1TWdfiBmxSJvjPdr396yir/view?usp=drive_link" -o app/src/main/assets/proton-9.0-x86_64.txz

       - name: Grant execute permission for gradlew
       run: chmod +x gradlew

       - name: Build with Gradle
       run: ./gradlew assembleDebug

       - name: Upload APK
       uses: actions/upload-artifact@v4
       with:
        name: Winlator APK
        path: app/build/outputs/apk/debug/app-debug.apk
